<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="After a sample is aligned to a target library with
align_target_bowtie(), we may use filter_host_bowtie() to
remove unwelcome host contamination using filter reference libraries. This
function takes as input the name of the .bam file produced via
align_target_bowtie(), and produces a sorted .bam or .csv.gz file with
any reads that match the filter libraries removed. This resulting .bam file
may be used downstream for further analysis. This function uses Rbowtie2 For
the Rsubread equivalent of this function, see filter_host."><title>Use Rbowtie2 to align reads against one or more filter libraries and subsequently remove mapped reads — filter_host_bowtie • MetaScope</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Use Rbowtie2 to align reads against one or more filter libraries and subsequently remove mapped reads — filter_host_bowtie"><meta property="og:description" content="After a sample is aligned to a target library with
align_target_bowtie(), we may use filter_host_bowtie() to
remove unwelcome host contamination using filter reference libraries. This
function takes as input the name of the .bam file produced via
align_target_bowtie(), and produces a sorted .bam or .csv.gz file with
any reads that match the filter libraries removed. This resulting .bam file
may be used downstream for further analysis. This function uses Rbowtie2 For
the Rsubread equivalent of this function, see filter_host."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-dark" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">MetaScope</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.7.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../index.html">Home</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-tutorials">Tutorials</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-tutorials">
    <a class="dropdown-item" href="../articles/MetaScope_vignette.html">Introduction to MetaScope</a>
    <a class="dropdown-item" href="../articles/docs/SILVA.html">Usage with SILVA 16S Database</a>
    <a class="dropdown-item" href="../articles/docs/Example_Script.html">Example MetaScope Script</a>
  </div>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Function Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Package News</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/wejlab/MetaScope">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Use Rbowtie2 to align reads against one or more filter libraries and subsequently remove mapped reads</h1>
      <small class="dont-index">Source: <a href="https://github.com/wejlab/MetaScope/blob/HEAD/R/filter_host.R" class="external-link"><code>R/filter_host.R</code></a></small>
      <div class="d-none name"><code>filter_host_bowtie.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>After a sample is aligned to a target library with
<code><a href="align_target_bowtie.html">align_target_bowtie()</a></code>, we may use <code>filter_host_bowtie()</code> to
remove unwelcome host contamination using filter reference libraries. This
function takes as input the name of the .bam file produced via
<code><a href="align_target_bowtie.html">align_target_bowtie()</a></code>, and produces a sorted .bam or .csv.gz file with
any reads that match the filter libraries removed. This resulting .bam file
may be used downstream for further analysis. This function uses Rbowtie2 For
the Rsubread equivalent of this function, see <code>filter_host</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">filter_host_bowtie</span><span class="op">(</span></span>
<span>  <span class="va">reads_bam</span>,</span>
<span>  <span class="va">lib_dir</span>,</span>
<span>  <span class="va">libs</span>,</span>
<span>  make_bam <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  output <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/fileutils.html" class="external-link">file_path_sans_ext</a></span><span class="op">(</span><span class="va">reads_bam</span><span class="op">)</span>, <span class="st">"filtered"</span>, sep <span class="op">=</span> <span class="st">"."</span><span class="op">)</span>,</span>
<span>  bowtie2_options <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  YS <span class="op">=</span> <span class="fl">1e+05</span>,</span>
<span>  threads <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>reads_bam</dt>
<dd><p>The name of a merged, sorted .bam file that has previously
been aligned to a reference library. Likely, the output from running an
instance of <code><a href="align_target_bowtie.html">align_target_bowtie()</a></code>.</p></dd>


<dt>lib_dir</dt>
<dd><p>Path to the directory that contains the filter Bowtie2 index
files.</p></dd>


<dt>libs</dt>
<dd><p>The basename of the filter libraries (without .bt2 or .bt2l
extension).</p></dd>


<dt>make_bam</dt>
<dd><p>Logical, whether to also output a bam file with host reads
filtered out. A .csv.gz file will be created instead if <code>FALSE</code>.
Creating a bam file is costly on resources over creating a compressed
csv file with only relevant information, so default is <code>FALSE</code>.</p></dd>


<dt>output</dt>
<dd><p>The desired name of the output .bam or .csv.gz file. Extension is
automatically defined by whether <code>make_bam = TRUE.</code> Default is the
basename of <code>unfiltered_bam</code> + <code>.filtered</code> + extension.</p></dd>


<dt>bowtie2_options</dt>
<dd><p>Optional: Additional parameters that can be passed to
the filter_host_bowtie() function. To see all the available parameters use
Rbowtie2::bowtie2_usage(). See Details for default parameters.
NOTE: Users should pass all their parameters as
one string and if optional parameters are given then the user is
responsible for entering all the parameters to be used by Bowtie2.
The only parameters that should NOT be specified here is the threads.</p></dd>


<dt>YS</dt>
<dd><p>yieldSize, an integer. The number of alignments to be read in from
the bam file at once for chunked functions. Default is 100000.</p></dd>


<dt>threads</dt>
<dd><p>The amount of threads available for the function. Default is 1
thread.</p></dd>


<dt>overwrite</dt>
<dd><p>Whether existing files should be overwritten. Default is
FALSE.</p></dd>


<dt>quiet</dt>
<dd><p>Turns off most messages. Default is <code>TRUE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>The name of a filtered, sorted .bam file written to the user's
  current working directory. Or, if <code>make_bam = FALSE</code>, a .csv.gz file
  containing a data frame of only requisite information to run</p>
<p></p>
<p><code><a href="metascope_id.html">metascope_id()</a></code>.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>A compressed .csv can be created to produce a smaller output file that is
created more efficiently and is still compatible with <code><a href="metascope_id.html">metascope_id()</a></code>.</p>
<p>The default parameters are the same that PathoScope 2.0 uses.
"--very-sensitive-local -k 100 --score-min L,20,1.0"</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">#### Filter reads from bam file that align to any of the filter libraries</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Assuming a bam file has already been created with align_target_bowtie()</span></span></span>
<span class="r-in"><span><span class="co"># Create temporary filter library</span></span></span>
<span class="r-in"><span><span class="va">filter_ref_temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">filter_ref_temp</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Create temporary taxonomizr accession</span></span></span>
<span class="r-in"><span><span class="va">tmp_accession</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"example_accessions.sql"</span>, package <span class="op">=</span> <span class="st">"MetaScope"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Download reference genome</span></span></span>
<span class="r-in"><span><span class="fu">MetaScope</span><span class="fu">::</span><span class="fu"><a href="download_refseq.html">download_refseq</a></span><span class="op">(</span><span class="st">"Orthoebolavirus zairense"</span>,</span></span>
<span class="r-in"><span>                           reference <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>                           representative <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>                           compress <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                           out_dir <span class="op">=</span> <span class="va">filter_ref_temp</span>,</span></span>
<span class="r-in"><span>                           caching <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                           accession_path <span class="op">=</span> <span class="va">tmp_accession</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "/scratch/306243.1.ood/RtmpllTcXS/file2ecdbc2a1e4b73/Orthoebolavirus_zairense.fasta.gz"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Create temp directory to store the indices</span></span></span>
<span class="r-in"><span><span class="va">index_temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">index_temp</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Create filter index</span></span></span>
<span class="r-in"><span><span class="fu">MetaScope</span><span class="fu">::</span><span class="fu"><a href="mk_bowtie_index.html">mk_bowtie_index</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  ref_dir <span class="op">=</span> <span class="va">filter_ref_temp</span>,</span></span>
<span class="r-in"><span>  lib_dir <span class="op">=</span> <span class="va">index_temp</span>,</span></span>
<span class="r-in"><span>  lib_name <span class="op">=</span> <span class="st">"filter"</span>,</span></span>
<span class="r-in"><span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> arguments 'show.output.on.console', 'minimized' and 'invisible' are for Windows only</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Index building complete</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "/scratch/306243.1.ood/RtmpllTcXS/file2ecdbcbdd8478"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Create temporary folder to hold final output file</span></span></span>
<span class="r-in"><span><span class="va">output_temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">output_temp</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Get path to example bam</span></span></span>
<span class="r-in"><span><span class="va">bamPath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"bowtie_target.bam"</span>,</span></span>
<span class="r-in"><span>                       package <span class="op">=</span> <span class="st">"MetaScope"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">target_copied</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">output_temp</span>, <span class="st">"bowtie_target.bam"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.copy</a></span><span class="op">(</span><span class="va">bamPath</span>, <span class="va">target_copied</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Align and filter reads</span></span></span>
<span class="r-in"><span><span class="va">filter_out</span> <span class="op">&lt;-</span></span></span>
<span class="r-in"><span>  <span class="fu">filter_host_bowtie</span><span class="op">(</span></span></span>
<span class="r-in"><span>    reads_bam <span class="op">=</span> <span class="va">target_copied</span>,</span></span>
<span class="r-in"><span>    lib_dir <span class="op">=</span> <span class="va">index_temp</span>,</span></span>
<span class="r-in"><span>    libs <span class="op">=</span> <span class="st">"filter"</span>,</span></span>
<span class="r-in"><span>    threads <span class="op">=</span> <span class="fl">1</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Samtools not found on system. Using Rsamtools to create bam file"</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> arguments 'show.output.on.console', 'minimized' and 'invisible' are for Windows only</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   |                                                                              |                                                                      |   0%  |                                                                              |======================================================================| 100%</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Remove temporary directories</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">filter_ref_temp</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">index_temp</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">output_temp</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Site created by Aubrey Odom.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

